{% extends 'province/base.html' %}
{% load static %}

{% block title %} Visualizations on Provincial Data {% endblock %}

{% block content %}
<div class="container-fluid">
    <h1>Political Dynastic Ties Analysis on Provincial Level</h1>
    <p class="text-muted">Analyze dynasty structures and family name distributions in {{ selected_province }} ({{ selected_year }})</p>
    
    <!-- Family Name Distribution and Dynasty Sizes -->
    <div class="row mb-4">
        <div class="col-md-6">
            <h5>What is the largest family name dynasty in {{ selected_province }} ({{ selected_year }})?</h5>
            {% if top_family_warning %}
                <div class="alert alert-warning">{{ top_family_warning }}</div>
            {% else %}
                <div id="top-family-card"></div>
                <div id="top-family-politicians-card"></div>
            {% endif %}
        </div>
        
        <div class="col-md-6">
            <h5>What are the sizes of the dynasties in {{ selected_province }} ({{ selected_year }})? Which family name appears the most in these dynasties?</h5>
            {% if dynasty_warning %}
                <div class="alert alert-warning">{{ dynasty_warning }}</div>
            {% else %}
                <div id="dynasty-chart"></div>
            {% endif %}
        </div>
    </div>
    
    <!-- Concentration Analysis -->
    <div class="row mb-4">
        <div class="col-12">
            <h5>How is family name concentration in {{ selected_province }} ({{ selected_year }}) related to their average position weight? Where do the largest dynasties land on this scale?</h5>
            {% if concentration_warning %}
                <div class="alert alert-warning">{{ concentration_warning }}</div>
            {% else %}
                <div id="concentration-chart"></div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    {% if top_family %}
    const topFamilyCardContainer = document.getElementById('top-family-card');
    const topFamilyPoliticiansContainer = document.getElementById('top-family-politicians-card');
    if (topFamilyCardContainer) {
        topFamilyCardContainer.innerHTML = `
            <div style="
                background-color: #f0f8ff; 
                border: 1px solid #4682b4; 
                padding: 20px; 
                border-radius: 10px; 
                width: fit-content;
                font-family: Arial, sans-serif;
                box-shadow: 2px 2px 10px rgba(0,0,0,0.1);
                margin: 20px auto;
                text-align: center;
                display: flex;
                flex-direction: column;
                align-items: center;
            ">
                <strong style="font-size: 1.1em; margin-bottom: 8px;">Most Prominent Family Name:</strong>
                <span style="color: #1f4e79; font-size: 1.5em; font-weight: 600; margin-bottom: 5px;">
                    {{ top_family.Family }}
                </span>
                <span style="font-weight: bold; color: #d9534f; font-size: 1.1em;">
                    {{ top_family.Count }} Family Members
                </span>
            </div>
        `;
    }
        if (topFamilyPoliticiansContainer) {
        topFamilyPoliticiansContainer.innerHTML = `
            <div style="
                background-color: #fff8dc; 
                border: 1px solid #daa520; 
                padding: 15px; 
                border-radius: 10px; 
                width: fit-content;
                font-family: Arial, sans-serif;
                box-shadow: 2px 2px 8px rgba(0,0,0,0.1);
                margin: 10px auto;
                text-align: center;
            ">
                <strong style="font-size: 1.1em; margin-bottom: 8px; display: block;">Politicians in this Family:</strong>
                <ul style="list-style-type: disc; margin: 0; padding-left: 20px; text-align: left;">
                    {% for politician in top_family.Politicians %}
                        <li>{{ politician }}</li>
                    {% endfor %}
                </ul>
            </div>
        `;
    }
    {% endif %}
        
    {% if dynasty_chart %}
    var dynastyChart = JSON.parse('{{ dynasty_chart|escapejs }}');
    Plotly.newPlot('dynasty-chart', dynastyChart.data, dynastyChart.layout);
    {% endif %}
    
    {% if concentration_chart %}
    var concentrationChart = JSON.parse('{{ concentration_chart|escapejs }}');
    Plotly.newPlot('concentration-chart', concentrationChart.data, concentrationChart.layout);
    {% endif %}
</script>
{% endblock %}
